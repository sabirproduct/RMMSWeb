<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer List</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="styles.css"> <!-- Optional: Link to external CSS -->
</head>
<body class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>Customer List</h1>
        <button class="btn btn-primary" onclick="redirectToAddCustomer()">Add New Customer</button>
    </div>

    <table id="customerTable" class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Name</th>
                <th>Address</th>
                <th>Mobile 1</th>
                <th>Mobile 2</th>
                <th>Email</th>
                <th>GSTIN</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Example row -->
            <tr>
                <td>John Doe</td>
                <td>123 Main Street</td>
                <td>9876543210</td>
                <td>9123456789</td>
                <td>john.doe@example.com</td>
                <td>22AAAAA0000A1Z5</td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="editCustomer(this)">Edit</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteCustomer()">Delete</button>
                </td>
            </tr>
            <!-- Additional rows will be dynamically added -->
            <tr>
                <td>John Shena</td>
                <td>123 Main Street</td>
                <td>9876543210</td>
                <td>9123456789</td>
                <td>john.doe@example.com</td>
                <td>22AAAAA0000A1Z5</td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="editCustomer(this)">Edit</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteCustomer()">Delete</button>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#customerTable').DataTable({
                searching: true, // Enable search field
                paging: true,    // Enable pagination
                info: true       // Show table info
            });
        });

        function editCustomer(button) {
            const row = button.closest('tr');
            const cells = row.querySelectorAll('td');

            // Extract current values from the row
            const currentValues = Array.from(cells).slice(0, -1).map(cell => cell.textContent);

            // Replace cells with input fields for editing
            currentValues.forEach((value, index) => {
            cells[index].innerHTML = `<input type="text" class="form-control" value="${value}">`;
            });

            // Replace action buttons with Save and Cancel
            const actionsCell = cells[cells.length - 1];
            actionsCell.innerHTML = `
            <button class="btn btn-success btn-sm" onclick="saveEdit(this)">Save</button>
            <button class="btn btn-secondary btn-sm" onclick="cancelEdit(this, '${btoa(JSON.stringify(currentValues))}')">Cancel</button>
            `;
        }

        function saveEdit(button) {
            const row = button.closest('tr');
            const cells = row.querySelectorAll('td');

            // Save updated values back to the row
            Array.from(cells).slice(0, -1).forEach(cell => {
            const input = cell.querySelector('input');
            if (input) {
                cell.textContent = input.value;
            }
            });

            // Restore action buttons
            const actionsCell = cells[cells.length - 1];
            actionsCell.innerHTML = `
            <button class="btn btn-warning btn-sm" onclick="editCustomer(this)">Edit</button>
            <button class="btn btn-danger btn-sm" onclick="deleteCustomer()">Delete</button>
            `;
        }

        function cancelEdit(button, originalValues) {
            const row = button.closest('tr');
            const cells = row.querySelectorAll('td');

            let decryptedValues = JSON.parse(atob(originalValues));
            console.log(decryptedValues);
            // Restore original values
            decryptedValues.forEach((value, index) => {
                if (cells[index]) {
                    cells[index].textContent = value;
                }
            });

            // Restore action buttons
            const actionsCell = cells[cells.length - 1];
            if (actionsCell) {
                actionsCell.innerHTML = `<button class="btn btn-warning btn-sm" onclick="editCustomer(this)">Edit</button><button class="btn btn-danger btn-sm" onclick="deleteCustomer()">Delete</button>`;
            }
        }

        function deleteCustomer() {
            if (confirm('Are you sure you want to delete this customer?')) {
                alert('Delete functionality not implemented yet.');
            }
        }

        function redirectToAddCustomer() {
            let frameObject = {};
            frameObject.applicationName = 'framewithoutfilter';
            frameObject.title = "Add New Customer";
            frameObject.pageName = "addcustomer";
            if (typeof parent.createFrame === 'function') {
                parent.createFrame(frameObject);
            } else {
                console.error('createFrame function is not accessible or defined in the parent frame.');
            }
            // Here you can send the JSON object to your server using fetch or XMLHttpRequest      
        }
    </script>
</body>
</html>