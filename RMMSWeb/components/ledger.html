<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- html2pdf -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    .ledger-box {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      margin-top: 20px;
    }
    @media print {
      .no-print {
        display: none;
      }
    }
  </style>
</head>
<body class="bg-light">

<div class="container">
  <div class="ledger-box" id="ledgerContent">
    <div class="mb-3">
      <strong>Name:</strong> <span id="custName"></span><br>
      <strong>Phone:</strong> <span id="custPhone"></span><br>
      <strong>Address:</strong> <span id="custAddress"></span>
    </div>

    <table class="table table-bordered table-striped">
      <thead class="table-primary">
        <tr>
          <th>Date</th>
          <th>Description</th>
          <th>Debit (‚Çπ)</th>
          <th>Credit (‚Çπ)</th>
          <th>Balance (‚Çπ)</th>
        </tr>
      </thead>
      <tbody id="ledgerTable">
        <!-- Transactions will be injected here -->
      </tbody>
      <tfoot class="table-light">
        <tr>
          <td colspan="2"><strong>Total</strong></td>
          <td id="totalDebit">0</td>
          <td id="totalCredit">0</td>
          <td id="finalBalance" class="text-success fw-bold">0</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <div class="text-center mt-3 no-print">
    <button class="btn btn-primary me-2" onclick="printLedger()">üñ®Ô∏è Print</button>
    <button class="btn btn-success" onclick="downloadPDF()">üìÑ Download PDF</button>
  </div>
</div>

<script>
  
  const data = parent.GetFromServer('ledger').customer1;
    console.log(data);
  
  document.getElementById("custName").textContent = data.name;
  document.getElementById("custPhone").textContent = data.phone;
  document.getElementById("custAddress").textContent = data.address;

  const table = document.getElementById("ledgerTable");
  let balance = 0, totalDebit = 0, totalCredit = 0;

  data.transactions.forEach(txn => {
    balance += (txn.debit || 0) - (txn.credit || 0);
    totalDebit += txn.debit || 0;
    totalCredit += txn.credit || 0;

    const row = `<tr>
      <td>${txn.date}</td>
      <td>${txn.desc}</td>
      <td>${txn.debit.toFixed(2)}</td>
      <td>${txn.credit.toFixed(2)}</td>
      <td>${balance.toFixed(2)}</td>
    </tr>`;
    table.innerHTML += row;
  });

  document.getElementById("totalDebit").textContent = totalDebit.toFixed(2);
  document.getElementById("totalCredit").textContent = totalCredit.toFixed(2);
  document.getElementById("finalBalance").textContent = balance.toFixed(2);

  // ‚úÖ Export to PDF
  function downloadPDF() {
    const element = document.getElementById("ledgerContent");
    html2pdf().from(element).set({
      margin: 0.5,
      filename: 'Customer_Ledger.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    }).save();
  }

  // ‚úÖ Print page
  function printLedger() {
    window.print();
  }
</script>

</body>
</html>
